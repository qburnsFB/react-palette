{"version":3,"file":"react-palette.js","sources":["../src/getPalette.ts","../src/loadImage.js","../src/usePalette.tsx","../src/Palette.tsx"],"sourcesContent":["import Vibrant from \"node-vibrant\";\nimport camelCase from \"lodash.camelcase\";\nimport invoke from 'lodash.invoke';\nimport loadImage from './loadImage';\n\nexport type PaletteColors = {\n  vibrant?: string;\n  muted?: string;\n  darkVibrant?: string;\n  darkMuted?: string;\n  lightVibrant?: string;\n  lightMuted?: string;\n  [name: string]: string | undefined;\n};\n\nexport async function getPalette(src: string) {\n  const img = await loadImage(src);\n  const palette = await Vibrant.from(img).getPalette();\n  const setPaletteColor = (acc, paletteName) => ({\n    ...acc,\n    [camelCase(paletteName)]: invoke(palette, [paletteName, 'getHex'])\n  });\n\n  return Object.keys(palette).reduce<PaletteColors>(setPaletteColor, {});\n}\n","/**\r\n * Load a image like a browser\r\n * @param {String} url\r\n * @param {String} crossOrigin\r\n * @returns {Promise} Promise object that returns a image\r\n */\r\nexport default function loadImage(url, crossOrigin = '') {\r\n    return new Promise((resolve, reject) => {\r\n        const img = new Image();\r\n        img.addEventListener('load', () => {\r\n            resolve(img);\r\n        });\r\n        img.addEventListener('error', () => {\r\n            reject(new Error(`Failed to load image's URL: ${url}`));\r\n        });\r\n        img.crossOrigin = crossOrigin;\r\n        img.src = url;\r\n    });\r\n}\r\n","import { useEffect, useReducer } from \"react\";\nimport { getPalette, PaletteColors } from \"./getPalette\";\n\nexport type PaletteState = {\n  loading: boolean;\n  error?: Error;\n  data: PaletteColors;\n}\n\nconst initialState: PaletteState = {\n  loading: true,\n  data: {},\n  error: undefined\n}\n\nfunction reducer(state: PaletteState, action) {\n  switch (action.type) {\n    case 'getPalette':\n      return initialState;\n    case 'resolvePalette':\n      return { ...state, data: action.payload, loading: false };\n    case 'rejectPalette':\n      return { ...state, error: action.payload, loading: false };\n  }\n}\n\nexport function usePalette(src: string, existingData: PaletteColors = {}) {\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  useEffect(() => {\n    dispatch({type: 'getPalette'});\n\n\n    if (existingData.vibrant) {\n      dispatch({type: 'resolvePalette', payload: existingData});\n    } else {\n      getPalette(src)\n          .then(palette => {\n            dispatch({type: 'resolvePalette', payload: palette});\n          })\n          .catch(ex => {\n            dispatch({type: 'rejectPalette', payload: ex});\n          });\n    }\n  }, [src]);\n\n  return state;\n}\n","import React, { ReactNode } from \"react\";\nimport { PaletteState, usePalette } from \"./usePalette\";\n\nexport type PaletteProps = {\n  src: string;\n  children(palette: PaletteState): ReactNode;\n};\n\nexport const Palette: React.FC<PaletteProps> = ({\n  src,\n  children\n}: PaletteProps) => {\n  const palette = usePalette(src);\n\n  return <>{children(palette)}</>;\n};\n"],"names":["getPalette","src","url","Promise","resolve","reject","img","Image","addEventListener","Error","crossOrigin","Vibrant","from","palette","Object","keys","reduce","acc","paletteName","camelCase","invoke","initialState","loading","data","error","undefined","reducer","state","action","type","payload","usePalette","existingData","useReducer","useEffect","dispatch","vibrant","then","catch","ex","Palette","ref","React","children"],"mappings":"gMAesBA,WAAWC,+BCTCC,EDUJD,iBCVuB,IAC1C,IAAIE,iBAASC,EAASC,OACnBC,EAAM,IAAIC,MAChBD,EAAIE,iBAAiB,kBACjBJ,EAAQE,KAEZA,EAAIE,iBAAiB,mBACjBH,EAAO,IAAII,qCAAqCP,MAEpDI,EAAII,YAAcA,EAClBJ,EAAIL,IAAMC,oBDAVI,0BACgBK,EAAQC,KAAKN,GAAKN,4BAAlCa,UAMCC,OAAOC,KAAKF,GAASG,gBALHC,EAAKC,gBAAiBJ,iBAC1CG,UACFE,EAAUD,IAAeE,EAAOP,EAAS,CAACK,EAAa,gBAGS,0CCjBtD,IAAmBhB,EAAKQ,GCGjCW,EAA6B,CACjCC,SAAS,EACTC,KAAM,GACNC,WAAOC,GAGT,SAASC,EAAQC,EAAqBC,UAC5BA,EAAOC,UACR,oBACIR,MACJ,wBACIP,iBAAKa,GAAOJ,KAAMK,EAAOE,QAASR,SAAS,QAC/C,uBACIR,iBAAKa,GAAOH,MAAOI,EAAOE,QAASR,SAAS,cAIzCS,EAAW9B,EAAa+B,kBAA8B,UAC1CC,aAAWP,EAASL,wBAE9Ca,uBACEC,EAAS,CAACN,KAAM,eAGZG,EAAaI,QACfD,EAAS,CAACN,KAAM,iBAAkBC,QAASE,IAE3ChC,EAAWC,GACNoC,cAAKxB,GACJsB,EAAS,CAACN,KAAM,iBAAkBC,QAASjB,MAE5CyB,eAAMC,GACLJ,EAAS,CAACN,KAAM,gBAAiBC,QAASS,OAGjD,CAACtC,IAEG0B,MCtCIa,WAAmCC,oBAIxC5B,EAAUkB,gBAETW,gCAAGC,EAAS9B"}